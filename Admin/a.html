<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background-color: #f8fafc;
      color: #334155;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding: 20px 0;
      border-bottom: 1px solid #e2e8f0;
      flex-wrap: wrap;
      gap: 10px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 18px;
      font-weight: 600;
      color: #0ea5e9;
    }

    .logo::before {
      content: "○";
      font-size: 24px;
    }

    .logout-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      background: none;
      border: none;
      color: #64748b;
      cursor: pointer;
      font-size: 14px;
      padding: 8px 12px;
      border-radius: 6px;
      transition: background-color 0.2s;
    }

    .logout-btn:hover {
      background-color: #f1f5f9;
    }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      gap: 16px;
      min-height: 80px;
    }

    .stat-icon {
      width: 48px;
      height: 48px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: white;
      flex-shrink: 0;
    }

    .stat-icon.users {
      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
    }

    .stat-icon.students {
      background: linear-gradient(135deg, #10b981, #047857);
    }

    .stat-icon.teachers {
      background: linear-gradient(135deg, #6366f1, #4338ca);
    }

    .stat-icon.active {
      background: linear-gradient(135deg, #f59e0b, #d97706);
    }

    .stat-info h3 {
      font-size: 24px;
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 4px;
    }

    .stat-info p {
      font-size: 14px;
      color: #64748b;
    }

    /* Navigation Tabs */
    .nav-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      border-bottom: 1px solid #e2e8f0;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .nav-tabs::-webkit-scrollbar {
      display: none;
    }

    .nav-tab {
      padding: 12px 16px;
      background: none;
      border: none;
      font-size: 14px;
      font-weight: 500;
      color: #64748b;
      cursor: pointer;
      position: relative;
      transition: color 0.2s;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .nav-tab.active {
      color: #0ea5e9;
    }

    .nav-tab.active::after {
      content: "";
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 2px;
      background: #0ea5e9;
    }

    /* Section */
    .section {
      background: white;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      margin-bottom: 20px;
    }

    .section-header {
      padding: 20px;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      flex-wrap: wrap;
      gap: 15px;
    }

    .section-title {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 18px;
      font-weight: 600;
      color: #1e293b;
    }

    .section-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }

    .section-actions input,
    .section-actions select {
      padding: 8px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 14px;
      min-width: 120px;
    }

    .btn {
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
      border: 1px solid transparent;
      white-space: nowrap;
    }

    .btn-primary {
      background: #0ea5e9;
      border-color: #0ea5e9;
      color: white;
    }

    .btn-primary:hover {
      background: #0284c7;
      border-color: #0284c7;
    }

    .btn-success {
      background: #10b981;
      border-color: #10b981;
      color: white;
    }

    .btn-success:hover {
      background: #059669;
    }

    .btn-warning {
      background: #f59e0b;
      border-color: #f59e0b;
      color: white;
    }

    .btn-warning:hover {
      background: #d97706;
    }

    /* Filters */
    .filters-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
      padding: 20px;
      background: #f8fafc;
      border-bottom: 1px solid #e2e8f0;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .filter-group label {
      font-size: 12px;
      font-weight: 500;
      color: #64748b;
    }

    .filter-group select,
    .filter-group input {
      padding: 8px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 14px;
    }

    /* Table Styles */
    .table-container {
      overflow-x: auto;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    .data-table th {
      background: #f8fafc;
      padding: 12px;
      text-align: left;
      font-weight: 600;
      color: #374151;
      border-bottom: 1px solid #e5e7eb;
      white-space: nowrap;
    }

    .data-table td {
      padding: 12px;
      border-bottom: 1px solid #f3f4f6;
      vertical-align: top;
    }

    .data-table tr:hover {
      background: #f9fafb;
    }

    /* Tags */
    .tags {
      display: flex;
      gap: 5px;
      flex-wrap: wrap;
    }

    .tag {
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 500;
      background: #e0e7ff;
      color: #3730a3;
    }

    .tag.placement {
      background: #dcfce7;
      color: #166534;
    }

    .tag.higher-studies {
      background: #fef3c7;
      color: #92400e;
    }

    /* Action buttons */
    .btn-sm {
      padding: 4px 8px;
      font-size: 12px;
      border-radius: 4px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid;
      margin-right: 5px;
    }

    .btn-view {
      background: #dbeafe;
      border-color: #93c5fd;
      color: #1e40af;
    }

    .btn-edit {
      background: #f8fafc;
      border-color: #e2e8f0;
      color: #475569;
    }

    .btn-delete {
      background: #fef2f2;
      border-color: #fecaca;
      color: #dc2626;
    }

    .btn-allocate {
      background: #dcfce7;
      border-color: #bbf7d0;
      color: #166534;
    }

    /* Modal */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
      z-index: 1000;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      width: 100%;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }

    .modal-header {
      padding: 20px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 600;
      color: #1f2937;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 24px;
      color: #9ca3af;
      cursor: pointer;
    }

    .modal-body {
      padding: 20px;
    }

    /* Form Styles */
    #userForm {
      margin: 15px 20px;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: #f9f9f9;
      display: none;
    }

    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
    }

    .form-row input,
    .form-row select {
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #bbb;
      flex: 1;
      min-width: 120px;
    }

    .form-buttons {
      display: flex;
      gap: 10px;
      margin-top: 15px;
      flex-wrap: wrap;
    }

    .form-buttons button {
      padding: 8px 14px;
      border: none;
      border-radius: 6px;
      color: white;
      cursor: pointer;
      font-size: 14px;
    }

    .btn-save {
      background: #4CAF50;
    }

    .btn-cancel {
      background: #f44336;
    }

    /* Allocation Styles */
    .allocation-section {
      padding: 20px;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      margin: 20px;
      background: #f8fafc;
    }

    .student-allocation-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 10px;
      margin-top: 15px;
    }

    .student-allocation-item {
      padding: 8px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      background: white;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .student-allocation-item:hover {
      background: #f0f9ff;
      border-color: #0ea5e9;
    }

    .student-allocation-item.selected {
      background: #dbeafe;
      border-color: #2563eb;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }

      .filters-container {
        grid-template-columns: 1fr;
        padding: 15px;
      }

      .section-header {
        flex-direction: column;
        align-items: stretch;
        gap: 15px;
        padding: 15px;
      }

      .section-actions {
        flex-direction: column;
        align-items: stretch;
      }

      .table-container {
        font-size: 12px;
      }

      .data-table th,
      .data-table td {
        padding: 8px;
      }

      .modal-content {
        margin: 10px;
        max-width: calc(100vw - 20px);
      }
    }

    /* Hidden class */
    .hidden {
      display: none !important;
    }

    /* Student Details Modal Styles */
    .details-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      z-index: 1000;
    }

    .dialog-container {
      background: white;
      border-radius: 12px;
      width: 100%;
      max-width: 1000px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }

    .dialog-header {
      padding: 20px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f8fafc;
      border-radius: 12px 12px 0 0;
    }

    .close-button {
      background: none;
      border: none;
      font-size: 24px;
      color: #9ca3af;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background-color 0.2s;
    }

    .close-button:hover {
      background-color: #f3f4f6;
    }

    .dialog-title {
      font-size: 24px;
      font-weight: 700;
      color: #1f2937;
      margin: 0;
    }

    .dialog-subtitle {
      font-size: 14px;
      color: #6b7280;
      margin: 5px 0 0 0;
    }

    .dialog-content {
      padding: 20px;
    }

    .dialog-footer {
      padding: 20px;
      border-top: 1px solid #e5e7eb;
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      background: #f8fafc;
      border-radius: 0 0 12px 12px;
    }

    .section {
      margin-bottom: 20px;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      overflow: hidden;
    }

    .section-header {
      padding: 15px 20px;
      background: #f8fafc;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #e5e7eb;
      transition: background-color 0.2s;
    }

    .section-header:hover {
      background: #f1f5f9;
    }

    .section-title {
      font-weight: 600;
      color: #374151;
      font-size: 16px;
    }

    .expand-icon {
      font-size: 12px;
      color: #6b7280;
      transition: transform 0.2s;
    }

    .section-content {
      display: none;
      padding: 20px;
      background: white;
    }

    .section.expanded .section-content {
      display: block;
    }

    .section.expanded .section-header {
      background: #e0e7ff;
      border-bottom-color: #c7d2fe;
    }

    .activity-list p {
      margin: 5px 0;
      padding: 8px;
      background: #f9fafb;
      border-radius: 4px;
      font-size: 14px;
    }

    .empty-value {
      color: #9ca3af;
      font-style: italic;
    }

    .overflow-hidden {
      overflow: hidden;
    }

    /* File input custom styling */
    .file-input-wrapper {
      position: relative;
      display: inline-block;
    }

    .file-input-wrapper input[type=file] {
      position: absolute;
      left: -9999px;
    }

    .file-input-label {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: #059669;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: background-color 0.2s;
    }

    .file-input-label:hover {
      background: #047857;
    }

    .sid {
      display: flex;
      justify-content: center;
      align-items: center;

    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="logo">Admin Dashboard</div>
      <!-- ...existing code... -->
      <div class="sid">
        <a href="../forgot.html" class="logout-btn" style="text-decoration:none;">Change Password</a>
        <button class="logout-btn" onclick="logout()">↗ Logout</button>
      </div>

    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon users">👥</div>
        <div class="stat-info">
          <h3 id="totalUsers">45</h3>
          <p>Total Users</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon students">🎓</div>
        <div class="stat-info">
          <h3 id="totalStudents">30</h3>
          <p>Students</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon teachers">📚</div>
        <div class="stat-info">
          <h3 id="totalTeachers">15</h3>
          <p>Teachers</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon active">📈</div>
        <div class="stat-info">
          <h3 id="activeUsers">42</h3>
          <p>Active Users</p>
        </div>
      </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="nav-tabs">
      <button class="nav-tab active" onclick="switchTab('user-management')">User Management</button>
      <button class="nav-tab" onclick="switchTab('teacher-list')">Teachers List</button>
      <button class="nav-tab" onclick="switchTab('student-list')">Students List</button>
      <button class="nav-tab" onclick="switchTab('allocate-students')">Student Allocation</button>
    </div>

    <!-- User Management Section -->
    <div class="section" id="user-management" style="display:block;">
      <div class="section-header">
        <div class="section-title">👥 User Management</div>
        <div class="section-actions">
          <input type="text" id="searchInput" placeholder="🔍 Search by User ID..." onkeyup="filterUsers()">
          <select id="roleFilter" onchange="filterUsers()">
            <option value="">All Roles</option>
            <option value="student">Student</option>
            <option value="teacher">Teacher</option>
          </select>
          <div class="file-input-wrapper">
            <input type="file" id="bulkUploadFile" accept=".xlsx,.xls,.csv">
            <label for="bulkUploadFile" class="file-input-label">
              📤 Bulk Upload
            </label>
          </div>
          <button class="btn btn-warning" onclick="downloadExcelFormat()">📥 Download Excel Format</button>
          <button class="btn btn-primary" onclick="showAddUserForm()">➕ Add User</button>
        </div>
      </div>

      <!-- Add/Edit User Form -->
      <div id="userForm">
        <input type="hidden" id="editIndex">
        <div class="form-row">
          <input type="text" id="userId" placeholder="User ID">
          <input type="password" id="password" placeholder="Password">
          <select id="role">
            <option value="student">Student</option>
            <option value="teacher">Teacher</option>
          </select>
        </div>
        <div class="form-buttons">
          <button class="btn-save" onclick="saveUser()">💾 Save</button>
          <button class="btn-cancel" onclick="cancelUser()">❌ Cancel</button>
        </div>
      </div>

      <!-- User List -->
      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>User ID</th>
              <th>Role</th>
              <th>Status</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="userTableBody">
          </tbody>
        </table>
      </div>
    </div>

    <!-- Teachers List Section -->
    <div class="section hidden" id="teacher-list">
      <div class="section-header">
        <div class="section-title">📚 Teachers List</div>
        <div class="section-actions">
          <input type="text" id="teacherSearchInput" placeholder="🔍 Search teachers..." onkeyup="filterTeachers()">
        </div>
      </div>

      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>UID</th>
              <th>Email</th>
              <th>Contact</th>
              <th>Students Assigned</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="teacherTableBody">
          </tbody>
        </table>
      </div>
    </div>

    <!-- Students List Section -->
    <div class="section hidden" id="student-list">
      <div class="section-header">
        <div class="section-title">🎓 Students List</div>
      </div>

      <!-- Student Filters -->
      <div class="filters-container">
        <div class="filter-group">
          <label>Search</label>
          <input type="text" id="studentSearchInput" placeholder="Search by name or UID..." onkeyup="filterStudents()">
        </div>
        <div class="filter-group">
          <label>Domain</label>
          <select id="domainFilter" onchange="filterStudents()">
            <option value="">All Domains</option>
            <option value="Web Development">Web Development</option>
            <option value="Machine Learning">Machine Learning</option>
            <option value="Data Science">Data Science</option>
            <option value="Mobile Development">Mobile Development</option>
            <option value="Cybersecurity">Cybersecurity</option>
            <option value="Cloud Computing">Cloud Computing</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Year</label>
          <select id="yearFilter" onchange="filterStudents()">
            <option value="">All Years</option>
            <option value="2021">2021</option>
            <option value="2022">2022</option>
            <option value="2023">2023</option>
            <option value="2024">2024</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Section</label>
          <select id="sectionFilter" onchange="filterStudents()">
            <option value="">All Sections</option>
            <option value="A">Section A</option>
            <option value="B">Section B</option>
            <option value="C">Section C</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Soft Skills Rating</label>
          <select id="softSkillsFilter" onchange="filterStudents()">
            <option value="">All Ratings</option>
            <option value="5">Excellent (5)</option>
            <option value="4">Good (4)</option>
            <option value="3">Average (3)</option>
            <option value="2">Below Average (2)</option>
            <option value="1">Poor (1)</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Career Goal</label>
          <select id="careerGoalFilter" onchange="filterStudents()">
            <option value="">All Goals</option>
            <option value="Placement">Placement</option>
            <option value="Higher Studies">Higher Studies</option>
            <option value="Entrepreneurship">Entrepreneurship</option>
          </select>
        </div>
      </div>

      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>UID</th>
              <th>Name</th>
              <th>Semester</th>
              <th>Section</th>
              <th>Year</th>
              <th>SGPA</th>
              <th>Domain</th>
              <th>Career Goal</th>
              <th>Mentor</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="studentTableBody">
          </tbody>
        </table>
      </div>
    </div>

    <!-- Student Allocation Section -->
    <div class="section hidden" id="allocate-students">
      <div class="section-header">
        <div class="section-title">📚 Student Allocation to Teachers</div>
      </div>

      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>Teacher Name</th>
              <th>UID</th>
              <th>Email</th>
              <th>Students Assigned</th>
              <th>Max Capacity</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="allocationTableBody">
          </tbody>
        </table>
      </div>

      <!-- Allocation Interface -->
      <div id="allocationInterface" class="allocation-section hidden">
        <h3 id="selectedTeacherTitle">Allocating Students</h3>
        <p>Select students to allocate to this teacher (Max: 10)</p>
        <div id="studentAllocationGrid" class="student-allocation-grid"></div>
        <div style="margin-top: 15px;">
          <button class="btn btn-primary" onclick="confirmAllocation()">✅ Confirm Allocation</button>
          <button class="btn btn-cancel" onclick="cancelAllocation()">❌ Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Student Details Modal -->
  <div class="details-container hidden" id="studentModal">
    <div class="dialog-container hidden">
      <div class="dialog-header">
        <button class="close-button" onclick="closeDialog()">×</button>
        <h1 class="dialog-title">Student Information</h1>
        <p class="dialog-subtitle">Department of Computer Engineering</p>
      </div>

      <div class="dialog-content">
        <!-- Student's Personal Information -->
        <div class="section expanded">
          <div class="section-header" onclick="toggleSection(this)">
            <span class="section-title">Student's Personal Information</span>
            <span class="expand-icon">▲</span>
          </div>
          <div class="section-content">
            <table class="data-table">
              <tr>
                <th>Department</th>
                <td>Computer Engineering</td>
              </tr>
              <tr>
                <th>Full Name</th>
                <td id="studentFullName">Rahul Sharma</td>
              </tr>
              <tr>
                <th>Section</th>
                <td id="studentSection">A</td>
              </tr>
              <tr>
                <th>Semester</th>
                <td id="studentSemester">6</td>
              </tr>
              <tr>
                <th>Roll No./UID</th>
                <td id="studentUID">21CE001234</td>
              </tr>
              <tr>
                <th>Year of Admission</th>
                <td id="studentYear">2021</td>
              </tr>
              <tr>
                <th>Mobile No.</th>
                <td id="studentMobile">+91 9876543210</td>
              </tr>
              <tr>
                <th>Email ID</th>
                <td id="studentEmail">rahul.sharma@example.com</td>
              </tr>
              <tr>
                <th>LinkedIn ID</th>
                <td id="studentLinkedIn">linkedin.com/in/rahulsharma</td>
              </tr>
              <tr>
                <th>Permanent Address</th>
                <td id="studentAddress">123, MG Road, Sector 15, New Delhi - 110001</td>
              </tr>
            </table>
          </div>
        </div>

        <!-- Parent's Information -->
        <div class="section">
          <div class="section-header" onclick="toggleSection(this)">
            <span class="section-title">Parent's Information</span>
            <span class="expand-icon">▼</span>
          </div>
          <div class="section-content">
            <table class="data-table">
              <tr>
                <th>Father's Name</th>
                <td id="fatherName">Vikash Sharma</td>
              </tr>
              <tr>
                <th>Father's Mobile No.</th>
                <td id="fatherMobile">+91 9876543211</td>
              </tr>
              <tr>
                <th>Father's Email ID</th>
                <td id="fatherEmail">vikash.sharma@example.com</td>
              </tr>
              <tr>
                <th>Father's Occupation</th>
                <td id="fatherOccupation">Software Engineer</td>
              </tr>
              <tr>
                <th>Mother's Name</th>
                <td id="motherName">Priya Sharma</td>
              </tr>
              <tr>
                <th>Mother's Mobile No.</th>
                <td id="motherMobile">+91 9876543212</td>
              </tr>
              <tr>
                <th>Mother's Email ID</th>
                <td id="motherEmail">priya.sharma@example.com</td>
              </tr>
              <tr>
                <th>Mother's Occupation</th>
                <td id="motherOccupation">Teacher</td>
              </tr>
            </table>
          </div>
        </div>

        <!-- Academic Information - Before Admission -->
        <div class="section">
          <div class="section-header" onclick="toggleSection(this)">
            <span class="section-title">Academic Information - Before Admission</span>
            <span class="expand-icon">▼</span>
          </div>
          <div class="section-content">
            <table class="data-table">
              <tr>
                <th>SSC (X) Percentage/Grade</th>
                <td id="sscPercentage">92.5%</td>
              </tr>
              <tr>
                <th>SSC Year of Passing</th>
                <td id="sscYear">2018</td>
              </tr>
              <tr>
                <th>HSSC (XII) Percentage/Grade</th>
                <td id="hsscPercentage">90%</td>
              </tr>
              <tr>
                <th>HSSC Year of Passing</th>
                <td id="hsscYear">2020</td>
              </tr>
              <tr>
                <th>Diploma Percentage/Grade</th>
                <td><span class="empty-value">N/A</span></td>
              </tr>
              <tr>
                <th>Diploma Year of Passing</th>
                <td><span class="empty-value">N/A</span></td>
              </tr>
            </table>
          </div>
        </div>

        <!-- Academic Information - After Admission -->
        <div class="section">
          <div class="section-header" onclick="toggleSection(this)">
            <span class="section-title">Academic Information - After Admission</span>
            <span class="expand-icon">▼</span>
          </div>
          <div class="section-content">
            <table class="data-table">
              <tr>
                <th>Semester 1 SGPA</th>
                <td id="sem1SGPA">8.2</td>
              </tr>
              <tr>
                <th>Semester 2 SGPA</th>
                <td id="sem2SGPA">8.4</td>
              </tr>
              <tr>
                <th>Semester 3 SGPA</th>
                <td id="sem3SGPA">8.6</td>
              </tr>
              <tr>
                <th>Semester 4 SGPA</th>
                <td id="sem4SGPA">8.5</td>
              </tr>
              <tr>
                <th>Semester 5 SGPA</th>
                <td id="sem5SGPA">8.7</td>
              </tr>
              <tr>
                <th>Semester 6 SGPA</th>
                <td id="sem6SGPA">8.5</td>
              </tr>
              <tr>
                <th>Semester 7 SGPA</th>
                <td><span class="empty-value">N/A</span></td>
              </tr>
              <tr>
                <th>Semester 8 SGPA</th>
                <td><span class="empty-value">N/A</span></td>
              </tr>
              <tr>
                <th>Current Semester</th>
                <td id="currentSemester">6</td>
              </tr>
              <tr>
                <th>Number of Active Backlogs</th>
                <td id="backlogCount">0</td>
              </tr>
              <tr>
                <th>Backlog Subject Names</th>
                <td id="backlogSubjects"><span class="empty-value">None</span></td>
              </tr>
            </table>
          </div>
        </div>

        <!-- Performance in Career Development Activities -->
        <div class="section">
          <div class="section-header" onclick="toggleSection(this)">
            <span class="section-title">Performance in Career Development Activities</span>
            <span class="expand-icon">▼</span>
          </div>
          <div class="section-content">
            <table class="data-table">
              <tr>
                <th>Aptitude Test Score/Rank</th>
                <td id="aptitudeScore">85/100</td>
              </tr>
              <tr>
                <th>Aptitude Test Date</th>
                <td id="aptitudeDate">2023-10-15</td>
              </tr>
              <tr>
                <th>Co-Cubes Score/Rank</th>
                <td id="cocubesScore">720/1000</td>
              </tr>
              <tr>
                <th>Co-Cubes Date</th>
                <td id="cocubesDate">2023-11-20</td>
              </tr>
              <tr>
                <th>GATE/CAT Score/Rank</th>
                <td id="gateScore">650 (GATE)</td>
              </tr>
              <tr>
                <th>GATE/CAT Date</th>
                <td id="gateDate">2024-02-10</td>
              </tr>
              <tr>
                <th>Other Exam Name</th>
                <td id="otherExamName">Google Data Analytics</td>
              </tr>
              <tr>
                <th>Other Exam Score/Rank</th>
                <td id="otherExamScore">Certified</td>
              </tr>
              <tr>
                <th>Other Exam Date</th>
                <td id="otherExamDate">2023-08-05</td>
              </tr>
            </table>
          </div>
        </div>

        <!-- Project and Internship Details -->
        <div class="section">
          <div class="section-header" onclick="toggleSection(this)">
            <span class="section-title">Project and Internship Details</span>
            <span class="expand-icon">▼</span>
          </div>
          <div class="section-content">
            <table class="data-table">
              <tr>
                <th>Micro Project Title</th>
                <td id="microProjectTitle">AI-powered Chatbot</td>
              </tr>
              <tr>
                <th>Micro Project Guide</th>
                <td id="microProjectGuide">Prof. Anil Kumar</td>
              </tr>
              <tr>
                <th>Major Project Title</th>
                <td id="majorProjectTitle">Inventory Management System</td>
              </tr>
              <tr>
                <th>Major Project Guide</th>
                <td id="majorProjectGuide">Prof. Sunita Verma</td>
              </tr>
              <tr>
                <th>Internship 1 Company</th>
                <td id="internship1Company">TechCorp Solutions</td>
              </tr>
              <tr>
                <th>Internship 1 Domain</th>
                <td id="internship1Domain">Web Development</td>
              </tr>
              <tr>
                <th>Internship 1 Type</th>
                <td id="internship1Type">Physical</td>
              </tr>
              <tr>
                <th>Internship 1 Paid/Unpaid</th>
                <td id="internship1Paid">Paid</td>
              </tr>
              <tr>
                <th>Internship 1 Duration</th>
                <td id="internship1Duration">2023-06-01 to 2023-08-01</td>
              </tr>
              <tr>
                <th>Internship 2 Company</th>
                <td id="internship2Company">DataTech Inc.</td>
              </tr>
              <tr>
                <th>Internship 2 Domain</th>
                <td id="internship2Domain">Data Science</td>
              </tr>
              <tr>
                <th>Internship 2 Type</th>
                <td id="internship2Type">Online</td>
              </tr>
              <tr>
                <th>Internship 2 Paid/Unpaid</th>
                <td id="internship2Paid">Unpaid</td>
              </tr>
              <tr>
                <th>Internship 2 Duration</th>
                <td id="internship2Duration">2023-12-01 to 2024-01-15</td>
              </tr>
            </table>
          </div>
        </div>

        <!-- Co-Curricular Activities -->
        <div class="section">
          <div class="section-header" onclick="toggleSection(this)">
            <span class="section-title">Co-Curricular Activities</span>
            <span class="expand-icon">▼</span>
          </div>
          <div class="section-content">
            <table class="data-table">
              <tr>
                <th>Participation Activities</th>
                <td>
                  <div class="activity-list">
                    <p>Name: CodeChef Monthly Contest, Date: 2023-09-10, Level: International,
                      Awards: Rank 150</p>
                    <p>Name: Smart India Hackathon, Date: 2023-12-15, Level: National, Awards:
                      Finalist</p>
                  </div>
                </td>
              </tr>
              <tr>
                <th>Organized Activities</th>
                <td>
                  <div class="activity-list">
                    <p>Name: Tech Fest 2023, Date: 2023-03-20, Level: Institute, Remark: Coordinator
                    </p>
                    <p>Name: Coding Workshop, Date: 2023-05-10, Level: Department, Remark:
                      Co-Coordinator</p>
                  </div>
                </td>
              </tr>
            </table>
          </div>
        </div>

        <!-- SWOC Analysis -->
        <div class="section">
          <div class="section-header" onclick="toggleSection(this)">
            <span class="section-title">SWOC Analysis</span>
            <span class="expand-icon">▼</span>
          </div>
          <div class="section-content">
            <table class="data-table">
              <tr>
                <th>Strengths</th>
                <td id="strengths">Strong problem-solving skills, Team leadership, Quick learner, Good communication
                </td>
              </tr>
              <tr>
                <th>Weaknesses</th>
                <td id="weaknesses">Time management, Public speaking anxiety</td>
              </tr>
              <tr>
                <th>Opportunities</th>
                <td id="opportunities">Growing AI/ML industry, Remote work opportunities, Startup ecosystem</td>
              </tr>
              <tr>
                <th>Challenges</th>
                <td id="challenges">Balancing academics with skill development, Staying updated with latest technologies
                </td>
              </tr>
            </table>
          </div>
        </div>

        <!-- Career Objectives and Skills -->
        <div class="section">
          <div class="section-header" onclick="toggleSection(this)">
            <span class="section-title">Career Objectives and Skills</span>
            <span class="expand-icon">▼</span>
          </div>
          <div class="section-content">
            <table class="data-table">
              <tr>
                <th>Career Objectives</th>
                <td id="careerObjectives">Job, Higher studies</td>
              </tr>
              <tr>
                <th>Specific Details</th>
                <td id="careerDetails">Software engineer role in tech industry, Pursue MS in Computer Science</td>
              </tr>
              <tr>
                <th>Clarity and Preparedness</th>
                <td id="clarityPreparedness">Good</td>
              </tr>
              <tr>
                <th>Interested in Campus Placement</th>
                <td id="campusPlacement">Yes</td>
              </tr>
              <tr>
                <th>Interpersonal Skills (1-5)</th>
                <td id="interpersonalSkills">4</td>
              </tr>
              <tr>
                <th>Soft Skills</th>
                <td id="softSkills">Presentation Skills, Writing</td>
              </tr>
              <tr>
                <th>Domain of Interest</th>
                <td id="domainOfInterest">
                  <div class="tags">
                    <span class="tag">Web Development</span>
                    <span class="tag">Machine Learning</span>
                    <span class="tag">Data Science</span>
                  </div>
                </td>
              </tr>
              <tr>
                <th>Additional Technical Skills Desired</th>
                <td id="additionalSkills">Cloud Computing, Advanced Machine Learning</td>
              </tr>
              <tr>
                <th>Expectations from Institute/Department</th>
                <td id="expectations">Industry mentorship, Advanced technical workshops, Placement preparation</td>
              </tr>
            </table>
          </div>
        </div>
      </div>

      <div class="dialog-footer">
        <button class="btn" onclick="printDialog()">Print</button>
        <button class="btn btn-primary" onclick="downloadData()">Download</button>
        <button class="btn" onclick="closeDialog()">Close</button>
      </div>
    </div>
  </div>

  <!-- Teacher Details Modal -->
  <div id="teacherModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Teacher Details</h3>
        <button class="close-btn" onclick="closeTeacherModal()">&times;</button>
      </div>
      <div class="modal-body" id="teacherModalBody">
        <!-- Teacher details will be loaded here -->
      </div>
    </div>
  </div>

  <script>
    // Dummy Data
    let teachers = [
      {
        id: 1,
        name: "Dr. Rajesh Kumar",
        uid: "FAC001",
        email: "rajesh.kumar@university.edu",
        contact: "+91 9876543210",
        firstName: "Rajesh",
        lastName: "Kumar",
        studentsAssigned: []
      },
      {
        id: 2,
        name: "Prof. Priya Sharma",
        uid: "FAC002",
        email: "priya.sharma@university.edu",
        contact: "+91 9876543211",
        firstName: "Priya",
        lastName: "Sharma",
        studentsAssigned: []
      },
      {
        id: 3,
        name: "Dr. Amit Patel",
        uid: "FAC003",
        email: "amit.patel@university.edu",
        contact: "+91 9876543212",
        firstName: "Amit",
        lastName: "Patel",
        studentsAssigned: []
      },
      {
        id: 4,
        name: "Prof. Sunita Desai",
        uid: "FAC004",
        email: "sunita.desai@university.edu",
        contact: "+91 9876543213",
        firstName: "Sunita",
        lastName: "Desai",
        studentsAssigned: []
      },
      {
        id: 5,
        name: "Dr. Vikram Singh",
        uid: "FAC005",
        email: "vikram.singh@university.edu",
        contact: "+91 9876543214",
        firstName: "Vikram",
        lastName: "Singh",
        studentsAssigned: []
      }
    ];

    let students = [
      {
        id: 1,
        uid: "21CE001",
        firstName: "Rahul",
        middleName: "Kumar",
        lastName: "Sharma",
        semester: 6,
        section: "A",
        year: 2021,
        sgpa: 8.5,
        mentorId: null,
        domain: ["Web Development", "Machine Learning"],
        careerGoal: "Placement",
        softSkillsRating: 4,
        email: "rahul.sharma@student.edu",
        mobile: "+91 9876543215",
        fatherName: "Vikash Sharma",
        motherName: "Priya Sharma",
        permanentAddress: "123, MG Road, New Delhi",
        linkedInId: "linkedin.com/in/rahulsharma",
        backlogSubjects: "None",
        projects: ["AI Chatbot", "E-commerce Website"],
        internships: ["TCS", "Infosys"],
        skills: ["Python", "JavaScript", "React"],
        strengths: "Analytical thinking, Communication",
        weaknesses: "Public speaking",
        opportunities: "Research opportunities",
        challenges: "Academic pressure"
      },
      {
        id: 2,
        uid: "21CE002",
        firstName: "Priya",
        middleName: "Rajesh",
        lastName: "Patel",
        semester: 5,
        section: "B",
        year: 2021,
        sgpa: 9.1,
        mentorId: null,
        domain: ["Data Science", "Machine Learning"],
        careerGoal: "Higher Studies",
        softSkillsRating: 5,
        email: "priya.patel@student.edu",
        mobile: "+91 9876543216",
        fatherName: "Rajesh Patel",
        motherName: "Sunita Patel",
        permanentAddress: "456, Gandhi Street, Mumbai",
        linkedInId: "linkedin.com/in/priyapatel",
        backlogSubjects: "None",
        projects: ["Data Analysis Tool", "ML Prediction Model"],
        internships: ["Google", "Microsoft"],
        skills: ["Python", "R", "Tableau"],
        strengths: "Problem solving, Team leadership",
        weaknesses: "Time management",
        opportunities: "Growing AI industry",
        challenges: "High competition"
      },
      {
        id: 3,
        uid: "22CE003",
        firstName: "Amit",
        middleName: "Kumar",
        lastName: "Singh",
        semester: 4,
        section: "A",
        year: 2022,
        sgpa: 7.8,
        mentorId: null,
        domain: ["Mobile Development", "Web Development"],
        careerGoal: "Placement",
        softSkillsRating: 3,
        email: "amit.singh@student.edu",
        mobile: "+91 9876543217",
        fatherName: "Kumar Singh",
        motherName: "Radha Singh",
        permanentAddress: "789, Park Street, Kolkata",
        linkedInId: "linkedin.com/in/amitsingh",
        backlogSubjects: "Database Management",
        projects: ["Mobile App", "Portfolio Website"],
        internships: ["Startup XYZ"],
        skills: ["Java", "React Native", "Flutter"],
        strengths: "Quick learner, Adaptability",
        weaknesses: "Attention to detail",
        opportunities: "Mobile app market growth",
        challenges: "Technology updates"
      },
      {
        id: 4,
        uid: "21CE004",
        firstName: "Sneha",
        middleName: "Raj",
        lastName: "Gupta",
        semester: 6,
        section: "C",
        year: 2021,
        sgpa: 8.9,
        mentorId: null,
        domain: ["Cybersecurity", "Cloud Computing"],
        careerGoal: "Placement",
        softSkillsRating: 4,
        email: "sneha.gupta@student.edu",
        mobile: "+91 9876543218",
        fatherName: "Raj Gupta",
        motherName: "Meera Gupta",
        permanentAddress: "321, Civil Lines, Pune",
        linkedInId: "linkedin.com/in/snehagupta",
        backlogSubjects: "None",
        projects: ["Security Tool", "Cloud Migration"],
        internships: ["Cisco", "AWS"],
        skills: ["Python", "Linux", "AWS"],
        strengths: "Detail oriented, Problem solving",
        weaknesses: "Team collaboration",
        opportunities: "Cybersecurity demand",
        challenges: "Constant learning required"
      },
      {
        id: 5,
        uid: "22CE005",
        firstName: "Rohit",
        middleName: "Kumar",
        lastName: "Verma",
        semester: 3,
        section: "B",
        year: 2022,
        sgpa: 8.2,
        mentorId: null,
        domain: ["Web Development", "Data Science"],
        careerGoal: "Entrepreneurship",
        softSkillsRating: 5,
        email: "rohit.verma@student.edu",
        mobile: "+91 9876543219",
        fatherName: "Kumar Verma",
        motherName: "Sita Verma",
        permanentAddress: "654, Main Road, Chennai",
        linkedInId: "linkedin.com/in/rohitverma",
        backlogSubjects: "None",
        projects: ["Startup Idea Platform", "Data Visualization"],
        internships: ["Tech Startup"],
        skills: ["JavaScript", "Python", "Node.js"],
        strengths: "Leadership, Innovation",
        weaknesses: "Patience",
        opportunities: "Startup ecosystem",
        challenges: "Market competition"
      },
      {
        id: 6,
        uid: "23CE006",
        firstName: "Kavya",
        middleName: "Raj",
        lastName: "Nair",
        semester: 2,
        section: "A",
        year: 2023,
        sgpa: 9.0,
        mentorId: null,
        domain: ["Machine Learning", "Data Science"],
        careerGoal: "Higher Studies",
        softSkillsRating: 4,
        email: "kavya.nair@student.edu",
        mobile: "+91 9876543220",
        fatherName: "Raj Nair",
        motherName: "Lakshmi Nair",
        permanentAddress: "987, Beach Road, Kochi",
        linkedInId: "linkedin.com/in/kavyanair",
        backlogSubjects: "None",
        projects: ["ML Research Project"],
        internships: ["Research Lab"],
        skills: ["Python", "TensorFlow", "R"],
        strengths: "Research mindset, Analytical",
        weaknesses: "Practical implementation",
        opportunities: "AI research growth",
        challenges: "Academic competition"
      }
    ];

    let users = [
      // Teachers
      { userId: "FAC001", password: "teacher123", role: "teacher", status: "Active", created: "2024-01-15" },
      { userId: "FAC002", password: "teacher123", role: "teacher", status: "Active", created: "2024-01-16" },
      { userId: "FAC003", password: "teacher123", role: "teacher", status: "Active", created: "2024-01-17" },
      { userId: "FAC004", password: "teacher123", role: "teacher", status: "Active", created: "2024-01-18" },
      { userId: "FAC005", password: "teacher123", role: "teacher", status: "Active", created: "2024-01-19" },

      // Students
      { userId: "21CE001", password: "student123", role: "student", status: "Active", created: "2024-02-01" },
      { userId: "21CE002", password: "student123", role: "student", status: "Active", created: "2024-02-01" },
      { userId: "22CE003", password: "student123", role: "student", status: "Active", created: "2024-02-02" },
      { userId: "21CE004", password: "student123", role: "student", status: "Active", created: "2024-02-02" },
      { userId: "22CE005", password: "student123", role: "student", status: "Active", created: "2024-02-03" },
      { userId: "23CE006", password: "student123", role: "student", status: "Active", created: "2024-02-04" }
    ];

    let allocations = {}; // { teacherId: [studentIds...] }
    let selectedTeacherForAllocation = null;

    // Initialize
    window.addEventListener('load', function () {
      renderUsers();
      renderTeachers();
      renderStudents();
      renderAllocation();
      updateStats();
    });

    // Tab Switching
    function switchTab(tabId) {
      document.querySelectorAll(".container > .section").forEach(sec => sec.classList.add('hidden'));
      document.getElementById(tabId).classList.remove('hidden');
      document.querySelectorAll(".nav-tab").forEach(btn => btn.classList.remove("active"));
      event.target.classList.add("active");
    }

    // User Management Functions
    function showAddUserForm() {
      document.getElementById("userForm").style.display = "block";
      document.getElementById("editIndex").value = "";
      document.getElementById("userId").value = "";
      document.getElementById("password").value = "";
      document.getElementById("role").value = "student";
    }

    function saveUser() {
      const userId = document.getElementById("userId").value.trim();
      const password = document.getElementById("password").value.trim();
      const role = document.getElementById("role").value;
      const editIndex = document.getElementById("editIndex").value;

      if (!userId || !password) {
        alert("Please enter User ID and Password");
        return;
      }

      const newUser = {
        userId,
        password,
        role,
        status: "Active",
        created: new Date().toISOString().split('T')[0]
      };

      if (editIndex === "") {
        users.push(newUser);
      } else {
        users[editIndex] = newUser;
      }

      document.getElementById("userForm").style.display = "none";
      renderUsers();
      updateStats();
    }

    function cancelUser() {
      document.getElementById("userForm").style.display = "none";
    }

    function renderUsers() {
      const tbody = document.getElementById("userTableBody");
      tbody.innerHTML = "";

      users.forEach((user, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td><strong>${user.userId}</strong></td>
          <td><span class="tag ${user.role}">${user.role}</span></td>
          <td><span class="tag" style="background: #dcfce7; color: #166534;">${user.status}</span></td>
          <td>${user.created}</td>
          <td>
            <button class="btn-sm btn-edit" onclick="editUser(${index})">✏ Edit</button>
            <button class="btn-sm btn-delete" onclick="deleteUser(${index})">🗑 Delete</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function editUser(index) {
      const user = users[index];
      document.getElementById("userForm").style.display = "block";
      document.getElementById("editIndex").value = index;
      document.getElementById("userId").value = user.userId;
      document.getElementById("password").value = user.password;
      document.getElementById("role").value = user.role;
    }

    function deleteUser(index) {
      if (confirm("Are you sure you want to delete this user?")) {
        users.splice(index, 1);
        renderUsers();
        updateStats();
      }
    }

    function filterUsers() {
      const search = document.getElementById("searchInput").value.toLowerCase();
      const roleFilter = document.getElementById("roleFilter").value;
      const rows = document.querySelectorAll("#userTableBody tr");

      rows.forEach(row => {
        const userId = row.cells[0].textContent.toLowerCase();
        const role = row.cells[1].textContent.toLowerCase();

        const matchesSearch = userId.includes(search);
        const matchesRole = roleFilter === "" || role.includes(roleFilter);

        if (matchesSearch && matchesRole) {
          row.style.display = "";
        } else {
          row.style.display = "none";
        }
      });
    }

    // Teachers Management
    function renderTeachers() {
      const tbody = document.getElementById("teacherTableBody");
      tbody.innerHTML = "";

      teachers.forEach(teacher => {
        const assignedCount = teacher.studentsAssigned ? teacher.studentsAssigned.length : 0;
        const row = document.createElement("tr");
        row.innerHTML = `
          <td><strong>${teacher.name}</strong></td>
          <td>${teacher.uid}</td>
          <td>${teacher.email}</td>
          <td>${teacher.contact}</td>
          <td><span class="tag">${assignedCount}/10</span></td>
          <td>
            <button class="btn-sm btn-view" onclick="viewTeacher(${teacher.id})">👁 View</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function filterTeachers() {
      const search = document.getElementById("teacherSearchInput").value.toLowerCase();
      const rows = document.querySelectorAll("#teacherTableBody tr");

      rows.forEach(row => {
        const name = row.cells[0].textContent.toLowerCase();
        const uid = row.cells[1].textContent.toLowerCase();

        if (name.includes(search) || uid.includes(search)) {
          row.style.display = "";
        } else {
          row.style.display = "none";
        }
      });
    }

    function viewTeacher(teacherId) {
      const teacher = teachers.find(t => t.id === teacherId);
      if (!teacher) return;

      const assignedStudents = teacher.studentsAssigned || [];
      const studentDetails = assignedStudents.map(studentId => {
        const student = students.find(s => s.uid === studentId);
        return student ? `${student.firstName} ${student.lastName} (${student.uid})` : studentId;
      }).join('<br>');

      document.getElementById("teacherModalBody").innerHTML = `
        <table class="data-table">
          <tr><th>Name</th><td>${teacher.name}</td></tr>
          <tr><th>UID</th><td>${teacher.uid}</td></tr>
          <tr><th>Email</th><td>${teacher.email}</td></tr>
          <tr><th>Contact</th><td>${teacher.contact}</td></tr>
          <tr><th>Students Assigned</th><td>${assignedStudents.length}/10</td></tr>
          <tr><th>Assigned Students</th><td>${studentDetails || 'None'}</td></tr>
        </table>
      `;
      document.getElementById("teacherModal").style.display = "flex";
    }

    function closeTeacherModal() {
      document.getElementById("teacherModal").style.display = "none";
    }

    // Students Management
    function renderStudents() {
      const tbody = document.getElementById("studentTableBody");
      tbody.innerHTML = "";

      students.forEach(student => {
        const mentor = student.mentorId ?
          teachers.find(t => t.id === student.mentorId)?.name || 'Unknown' :
          'Not Assigned';

        const row = document.createElement("tr");
        row.innerHTML = `
          <td><strong>${student.uid}</strong></td>
          <td>${student.firstName} ${student.lastName}</td>
          <td>${student.semester}</td>
          <td>${student.section}</td>
          <td>${student.year}</td>
          <td>${student.sgpa}</td>
          <td>
            <div class="tags">
              ${student.domain.map(d => `<span class="tag">${d}</span>`).join('')}
            </div>
          </td>
          <td><span class="tag ${student.careerGoal === 'Placement' ? 'placement' : 'higher-studies'}">${student.careerGoal}</span></td>
          <td>${mentor}</td>
          <td>
            <button class="btn-sm btn-view" onclick="viewStudent(${student.id})">👁 View</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function filterStudents() {
      const search = document.getElementById("studentSearchInput").value.toLowerCase();
      const domain = document.getElementById("domainFilter").value;
      const year = document.getElementById("yearFilter").value;
      const section = document.getElementById("sectionFilter").value;
      const softSkills = document.getElementById("softSkillsFilter").value;
      const careerGoal = document.getElementById("careerGoalFilter").value;

      const rows = document.querySelectorAll("#studentTableBody tr");

      rows.forEach((row, index) => {
        const student = students[index];
        if (!student) return;

        const matchesSearch = !search ||
          student.firstName.toLowerCase().includes(search) ||
          student.lastName.toLowerCase().includes(search) ||
          student.uid.toLowerCase().includes(search);

        const matchesDomain = !domain || student.domain.includes(domain);
        const matchesYear = !year || student.year.toString() === year;
        const matchesSection = !section || student.section === section;
        const matchesSoftSkills = !softSkills || student.softSkillsRating.toString() === softSkills;
        const matchesCareerGoal = !careerGoal || student.careerGoal === careerGoal;

        if (matchesSearch && matchesDomain && matchesYear && matchesSection && matchesSoftSkills && matchesCareerGoal) {
          row.style.display = "";
        } else {
          row.style.display = "none";
        }
      });
    }

    function viewStudent(studentId) {
      const student = students.find(s => s.id === studentId);
      if (!student) return;


      // Populate the detailed student information
      document.getElementById("studentFullName").textContent = `${student.firstName} ${student.middleName || ''} ${student.lastName}`;
      document.getElementById("studentSection").textContent = student.section;
      document.getElementById("studentSemester").textContent = student.semester;
      document.getElementById("studentUID").textContent = student.uid;
      document.getElementById("studentYear").textContent = student.year;
      document.getElementById("studentMobile").textContent = student.mobile;
      document.getElementById("studentEmail").textContent = student.email;
      document.getElementById("studentLinkedIn").textContent = student.linkedInId;
      document.getElementById("studentAddress").textContent = student.permanentAddress;

      // Parent information
      document.getElementById("fatherName").textContent = student.fatherName;
      document.getElementById("fatherMobile").textContent = student.mobile.replace(student.mobile.slice(-1), (parseInt(student.mobile.slice(-1)) + 1).toString());
      document.getElementById("fatherEmail").textContent = student.email.replace('@', '.father@');
      document.getElementById("fatherOccupation").textContent = "Software Engineer";
      document.getElementById("motherName").textContent = student.motherName;
      document.getElementById("motherMobile").textContent = student.mobile.replace(student.mobile.slice(-1), (parseInt(student.mobile.slice(-1)) + 2).toString());
      document.getElementById("motherEmail").textContent = student.email.replace('@', '.mother@');
      document.getElementById("motherOccupation").textContent = "Teacher";

      // Academic information
      document.getElementById("currentSemester").textContent = student.semester;
      document.getElementById("backlogCount").textContent = student.backlogSubjects === "None" ? "0" : "1";
      document.getElementById("backlogSubjects").innerHTML = student.backlogSubjects === "None" ? '<span class="empty-value">None</span>' : student.backlogSubjects;

      // Career development activities
      document.getElementById("aptitudeScore").textContent = "85/100";
      document.getElementById("aptitudeDate").textContent = "2023-10-15";
      document.getElementById("cocubesScore").textContent = "720/1000";
      document.getElementById("cocubesDate").textContent = "2023-11-20";
      document.getElementById("gateScore").textContent = "650 (GATE)";
      document.getElementById("gateDate").textContent = "2024-02-10";
      document.getElementById("otherExamName").textContent = "Google Data Analytics";
      document.getElementById("otherExamScore").textContent = "Certified";
      document.getElementById("otherExamDate").textContent = "2023-08-05";

      // Project and internship details
      document.getElementById("microProjectTitle").textContent = student.projects[0] || "AI-powered Chatbot";
      document.getElementById("microProjectGuide").textContent = "Prof. Anil Kumar";
      document.getElementById("majorProjectTitle").textContent = student.projects[1] || "Inventory Management System";
      document.getElementById("majorProjectGuide").textContent = "Prof. Sunita Verma";
      document.getElementById("internship1Company").textContent = student.internships[0] || "TechCorp Solutions";
      document.getElementById("internship1Domain").textContent = student.domain[0] || "Web Development";
      document.getElementById("internship1Type").textContent = "Physical";
      document.getElementById("internship1Paid").textContent = "Paid";
      document.getElementById("internship1Duration").textContent = "2023-06-01 to 2023-08-01";
      document.getElementById("internship2Company").textContent = student.internships[1] || "DataTech Inc.";
      document.getElementById("internship2Domain").textContent = student.domain[1] || "Data Science";
      document.getElementById("internship2Type").textContent = "Online";
      document.getElementById("internship2Paid").textContent = "Unpaid";
      document.getElementById("internship2Duration").textContent = "2023-12-01 to 2024-01-15";

      // SWOC Analysis
      document.getElementById("strengths").textContent = student.strengths;
      document.getElementById("weaknesses").textContent = student.weaknesses;
      document.getElementById("opportunities").textContent = student.opportunities;
      document.getElementById("challenges").textContent = student.challenges;

      // Career objectives and skills
      document.getElementById("careerObjectives").textContent = student.careerGoal === "Placement" ? "Job" : "Higher studies";
      document.getElementById("careerDetails").textContent = student.careerGoal === "Placement" ?
        "Software engineer role in tech industry" : "Pursue MS in Computer Science";
      document.getElementById("clarityPreparedness").textContent = "Good";
      document.getElementById("campusPlacement").textContent = student.careerGoal === "Placement" ? "Yes" : "No";
      document.getElementById("interpersonalSkills").textContent = student.softSkillsRating;
      document.getElementById("softSkills").textContent = "Presentation Skills, Writing";
      document.getElementById("additionalSkills").textContent = "Cloud Computing, Advanced Machine Learning";
      document.getElementById("expectations").textContent = "Industry mentorship, Advanced technical workshops, Placement preparation";

      // Update domain tags
      const domainContainer = document.getElementById("domainOfInterest");
      domainContainer.innerHTML = student.domain.map(d => `<span class="tag">${d}</span>`).join('');

      // Show the modal
      document.querySelector('.dialog-container').classList.remove('hidden');
      document.querySelector('.details-container').classList.remove('hidden');
      document.getElementsByTagName('body')[0].classList.add('overflow-hidden');
    }

    function closeDialog() {
      if (confirm('Are you sure you want to close?')) {
        document.querySelector('.dialog-container').classList.add('hidden');
        document.querySelector('.details-container').classList.add('hidden');
        document.getElementsByTagName('body')[0].classList.remove('overflow-hidden');
      }
    }

    function toggleSection(header) {
      const section = header.parentElement;
      section.classList.toggle('expanded');
      const icon = header.querySelector('.expand-icon');
      icon.textContent = section.classList.contains('expanded') ? '▲' : '▼';
    }

    function printDialog() {
      window.print();
    }

    function downloadData() {
      alert('Download functionality would be implemented here.');
    }

    // Student Allocation Functions
    function renderAllocation() {
      const tbody = document.getElementById("allocationTableBody");
      tbody.innerHTML = "";

      teachers.forEach(teacher => {
        const assignedCount = teacher.studentsAssigned ? teacher.studentsAssigned.length : 0;
        const row = document.createElement("tr");
        row.innerHTML = `
          <td><strong>${teacher.name}</strong></td>
          <td>${teacher.uid}</td>
          <td>${teacher.email}</td>
          <td><span class="tag">${assignedCount}</span></td>
          <td>10</td>
          <td>
            <button class="btn-sm btn-allocate" onclick="showAllocationInterface(${teacher.id})" ${assignedCount >= 10 ? 'disabled' : ''}>
              ➕ Allocate
            </button>
            <button class="btn-sm btn-view" onclick="viewAllocatedStudents(${teacher.id})">👁 View</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function showAllocationInterface(teacherId) {
      selectedTeacherForAllocation = teacherId;
      const teacher = teachers.find(t => t.id === teacherId);
      if (!teacher) return;

      const assignedStudents = teacher.studentsAssigned || [];
      if (assignedStudents.length >= 10) {
        alert("This teacher already has the maximum number of students (10).");
        return;
      }

      document.getElementById("selectedTeacherTitle").textContent = `Allocating Students to ${teacher.name}`;

      const unassignedStudents = students.filter(student => !isStudentAssigned(student.uid));
      const grid = document.getElementById("studentAllocationGrid");
      grid.innerHTML = "";

      if (unassignedStudents.length === 0) {
        grid.innerHTML = "<p>No unassigned students available.</p>";
      } else {
        unassignedStudents.forEach(student => {
          const div = document.createElement("div");
          div.className = "student-allocation-item";
          div.innerHTML = `
            <span><strong>${student.firstName} ${student.lastName}</strong><br>
            <small>${student.uid} - Sem ${student.semester}</small></span>
            <input type="checkbox" class="student-checkbox" data-student-uid="${student.uid}">
          `;
          grid.appendChild(div);
        });
      }

      document.getElementById("allocationInterface").classList.remove("hidden");
    }

    function isStudentAssigned(studentUid) {
      return teachers.some(teacher =>
        teacher.studentsAssigned && teacher.studentsAssigned.includes(studentUid)
      );
    }

    function confirmAllocation() {
      if (!selectedTeacherForAllocation) return;

      const checkboxes = document.querySelectorAll(".student-checkbox:checked");
      const selectedStudents = Array.from(checkboxes).map(cb => cb.getAttribute("data-student-uid"));

      if (selectedStudents.length === 0) {
        alert("Please select at least one student to allocate.");
        return;
      }

      const teacher = teachers.find(t => t.id === selectedTeacherForAllocation);
      const currentCount = teacher.studentsAssigned ? teacher.studentsAssigned.length : 0;

      if (currentCount + selectedStudents.length > 10) {
        alert(`Cannot allocate ${selectedStudents.length} students. This would exceed the maximum limit of 10 students per teacher.`);
        return;
      }

      if (!teacher.studentsAssigned) {
        teacher.studentsAssigned = [];
      }
      teacher.studentsAssigned.push(...selectedStudents);

      // Update student mentor assignments
      selectedStudents.forEach(studentUid => {
        const student = students.find(s => s.uid === studentUid);
        if (student) {
          student.mentorId = teacher.id;
        }
      });

      alert(`Successfully allocated ${selectedStudents.length} student(s) to ${teacher.name}`);
      cancelAllocation();
      renderAllocation();
      renderStudents();
    }

    function cancelAllocation() {
      document.getElementById("allocationInterface").classList.add("hidden");
      selectedTeacherForAllocation = null;
    }

    function viewAllocatedStudents(teacherId) {
      const teacher = teachers.find(t => t.id === teacherId);
      if (!teacher) return;

      const assignedStudents = teacher.studentsAssigned || [];
      let studentsHtml = "";

      if (assignedStudents.length === 0) {
        studentsHtml = "<p>No students assigned to this teacher.</p>";
      } else {
        studentsHtml = `
          <table class="data-table">
            <thead>
              <tr><th>Name</th><th>UID</th><th>Semester</th><th>SGPA</th><th>Actions</th></tr>
            </thead>
            <tbody>
        `;

        assignedStudents.forEach(studentUid => {
          const student = students.find(s => s.uid === studentUid);
          if (student) {
            studentsHtml += `
              <tr>
                <td>${student.firstName} ${student.lastName}</td>
                <td>${student.uid}</td>
                <td>${student.semester}</td>
                <td>${student.sgpa}</td>
                <td>
                  <button class="btn-sm btn-delete" onclick="deallocateStudent(${teacherId}, '${studentUid}')">
                    🗑 Remove
                  </button>
                </td>
              </tr>
            `;
          }
        });

        studentsHtml += "</tbody></table>";
      }

      document.getElementById("teacherModalBody").innerHTML = `
        <h4>Teacher: ${teacher.name} (${teacher.uid})</h4>
        <p>Assigned Students: ${assignedStudents.length}/10</p>
        <div style="margin-top: 20px;">
          ${studentsHtml}
        </div>
      `;
      document.getElementById("teacherModal").style.display = "flex";
    }

    function deallocateStudent(teacherId, studentUid) {
      if (!confirm("Are you sure you want to remove this student from the teacher?")) return;

      const teacher = teachers.find(t => t.id === teacherId);
      if (teacher && teacher.studentsAssigned) {
        teacher.studentsAssigned = teacher.studentsAssigned.filter(uid => uid !== studentUid);
      }

      // Update student mentor assignment
      const student = students.find(s => s.uid === studentUid);
      if (student) {
        student.mentorId = null;
      }

      alert("Student successfully removed from teacher.");
      viewAllocatedStudents(teacherId); // Refresh the view
      renderAllocation();
      renderStudents();
    }

    // Bulk Upload Functions
    document.getElementById('bulkUploadFile').addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          try {
            // This is a simplified version - you would need a proper CSV/Excel parser
            const data = e.target.result;
            alert('Bulk upload functionality would process the file here. File loaded: ' + file.name);
            // In a real implementation, you would parse CSV/Excel and add users
          } catch (error) {
            alert('Error processing file: ' + error.message);
          }
        };
        reader.readAsText(file);
      }
    });

    function downloadExcelFormat() {
      const csvContent = `User ID,Password,Role,First Name,Last Name,Email
FAC001,password123,teacher,John,Doe,john.doe@university.edu
21CE001,password123,student,Jane,Smith,jane.smith@student.edu`;

      const blob = new Blob([csvContent], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'bulk_upload_format.csv';
      a.click();
      window.URL.revokeObjectURL(url);
    }

    // Update Statistics
    function updateStats() {
      document.getElementById("totalUsers").innerText = users.length;
      document.getElementById("totalStudents").innerText = users.filter(u => u.role === "student").length;
      document.getElementById("totalTeachers").innerText = users.filter(u => u.role === "teacher").length;
      document.getElementById("activeUsers").innerText = users.filter(u => u.status === "Active").length;
    }

    // Logout function
    async function logout() {
      const token = localStorage.getItem("access_token");

      if (!token) {
        console.log("No token found, already logged out.");
        window.location.href = "../login.html";
        return;
      }

      try {
        const response = await fetch("http://localhost:5000/auth/logout", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + token
          }
        });

        if (response.ok) {
          console.log("Successfully logged out");
        } else {
          console.error("Logout failed:", await response.json());
        }
      } catch (error) {
        console.error("Error during logout:", error);
      }

      localStorage.removeItem("access_token");
      window.location.href = "../login.html";
    }
  </script>
</body>

</html>